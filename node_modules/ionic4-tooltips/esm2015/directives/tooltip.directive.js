/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ApplicationRef, ComponentFactoryResolver, Directive, ElementRef, HostListener, Input, ViewContainerRef, } from '@angular/core';
import { Platform } from '@ionic/angular';
import { TooltipBox } from '../components/tooltip-box/tooltip-box.component';
import { TooltipController } from '../controllers/tooltip.cotroller';
import { TooltipEvent } from '../models/tooltip-event.model';
export class TooltipDirective {
    /**
     * @param {?} el
     * @param {?} appRef
     * @param {?} platform
     * @param {?} cfr
     * @param {?} tooltipCtrl
     * @param {?} vcr
     */
    constructor(el, appRef, platform, cfr, tooltipCtrl, vcr) {
        this.el = el;
        this.appRef = appRef;
        this.platform = platform;
        this.cfr = cfr;
        this.tooltipCtrl = tooltipCtrl;
        this.vcr = vcr;
        this.debounce = 0;
        this.desktopEvent = TooltipEvent.HOVER;
        this.tooltipStyles = {};
        this.duration = 3000;
        this._active = false;
        this._arrow = false;
        this._canShow = true;
        this._debouncedPromise = null;
        this._navTooltip = false;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set navTooltip(val) {
        this._navTooltip = typeof val !== 'boolean' || val !== false;
    }
    /**
     * @return {?}
     */
    get navTooltip() {
        return this._navTooltip;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set arrow(val) {
        this._arrow = typeof val !== 'boolean' || val !== false;
    }
    /**
     * @return {?}
     */
    get arrow() {
        return this._arrow;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set active(val) {
        this._active = typeof val !== 'boolean' || val !== false;
        this._active && this.canShow ?
            this.showTooltip() : this.removeTooltip();
    }
    /**
     * @return {?}
     */
    get active() {
        return this._active;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (typeof this.event === 'undefined') {
            this.event = this.platform.is('mobile') ?
                this.mobileEvent : this.desktopEvent;
        }
        // if the timer hasn't expired or active is true when the component gets destroyed, the tooltip will remain in the DOM
        // this removes it
        this.removeTooltip();
    }
    /**
     * Show the tooltip immediately after initiating view if set to
     * @return {?}
     */
    ngAfterViewInit() {
        if (this._active) {
            this.trigger();
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this._tooltipElement && typeof this._tooltipElement.destroy === 'function') {
            this._tooltipElement.destroy();
        }
    }
    /**
     * Set the canShow property
     * Ensure that tooltip is shown only if the tooltip string is not falsey
     * @param {?} show
     * @return {?}
     */
    set canShow(show) {
        this._canShow = show;
    }
    /**
     * @return {?} TRUE if the tooltip can be shown
     */
    get canShow() {
        return this._canShow &&
            ((typeof this.tooltip === 'string' && this.tooltip !== '')
                || (typeof this.tooltipHtml === 'string' && this.tooltipHtml !== ''));
    }
    /**
     * Handles the click/press event and shows a tooltip.
     * If a tooltip already exists, it will just reset it's timer.
     * @return {?}
     */
    trigger() {
        if (this.canShow) {
            if (this._tooltipElement) {
                this._resetTimer();
            }
            else {
                this.showTooltip();
            }
        }
    }
    /**
     * Creates a new tooltip component and adjusts it's properties to show properly.
     * @return {?}
     */
    showTooltip() {
        this._debouncedPromise = setTimeout((/**
         * @return {?}
         */
        () => {
            this._debouncedPromise = null;
            this._createTooltipComponent();
            /** @type {?} */
            const tooltipComponent = this._tooltipElement.instance;
            tooltipComponent.role = this.role;
            tooltipComponent.text = this.tooltip;
            tooltipComponent.tooltipStyles = this.tooltipStyles;
            tooltipComponent.tooltipHtml = this.tooltipHtml;
            tooltipComponent.init.then((/**
             * @return {?}
             */
            () => {
                /** @type {?} */
                const tooltipPosition = this._getTooltipPosition();
                tooltipComponent.posLeft = tooltipPosition.left;
                tooltipComponent.posTop = tooltipPosition.top;
                tooltipComponent.fadeState = 'visible';
                if (this.arrow) {
                    /** @type {?} */
                    let arrowPosition;
                    if (this.positionV === 'top') {
                        arrowPosition = 'bottom';
                    }
                    else if (this.positionV === 'bottom') {
                        arrowPosition = 'top';
                    }
                    else if (this.positionH === 'left') {
                        arrowPosition = 'right';
                    }
                    else {
                        arrowPosition = 'left';
                    }
                    tooltipComponent.arrow = arrowPosition;
                }
                if (!this._active) {
                    this._tooltipTimeout = setTimeout(this.removeTooltip.bind(this), this.duration);
                }
            }));
        }), this.debounce);
    }
    /**
     * @return {?}
     */
    onClick() {
        if (this.event === TooltipEvent.CLICK) {
            this.trigger();
        }
    }
    /**
     * @return {?}
     */
    onPress() {
        if (this.event === TooltipEvent.PRESS) {
            this.trigger();
        }
    }
    /**
     * @return {?}
     */
    onMouseEnter() {
        if (this.event === TooltipEvent.HOVER) {
            this.active = true;
        }
    }
    /**
     * @return {?}
     */
    onMouseLeave() {
        if (this.event === TooltipEvent.HOVER) {
            this.active = false;
        }
    }
    /**
     * @private
     * @return {?}
     */
    _createTooltipComponent() {
        /** @type {?} */
        const componentFactory = this.cfr.resolveComponentFactory(TooltipBox);
        this._tooltipElement = this.vcr.createComponent(componentFactory);
        this.tooltipCtrl.addTooltip(this);
    }
    /**
     * @private
     * @return {?}
     */
    _getTooltipPosition() {
        /** @type {?} */
        const tooltipNativeElement = this._tooltipElement.instance.getNativeElement();
        /** @type {?} */
        const el = this.el.nativeElement;
        /** @type {?} */
        const rect = el.getBoundingClientRect();
        /** @type {?} */
        let positionLeft;
        /** @type {?} */
        let positionTop;
        /** @type {?} */
        let spacing = 10;
        if (this.navTooltip) {
            this.positionV = 'bottom';
            this.arrow = false;
            spacing = 20;
        }
        if (this.positionH === 'right') {
            positionLeft = rect.right + spacing;
        }
        else if (this.positionH === 'left') {
            positionLeft = rect.left - spacing - tooltipNativeElement.offsetWidth;
            // -79, 19
        }
        else if (this.navTooltip) {
            positionLeft = rect.left + el.offsetWidth / 2;
        }
        else {
            positionLeft = rect.left;
        }
        if (this.positionV === 'top') {
            positionTop = rect.top - spacing - tooltipNativeElement.offsetHeight;
        }
        else if (this.positionV === 'bottom') {
            positionTop = rect.bottom + spacing;
        }
        else {
            positionTop = rect.top + el.offsetHeight / 2 - tooltipNativeElement.offsetHeight / 2;
        }
        this.topOffset++;
        if (this.topOffset) {
            positionTop += +this.topOffset;
        }
        this.leftOffset++;
        if (this.leftOffset) {
            positionLeft += +this.leftOffset;
        }
        if (positionLeft + tooltipNativeElement.offsetWidth + spacing > this.platform.width()) {
            positionLeft = this.platform.width() - tooltipNativeElement.offsetWidth - spacing;
        }
        else if (positionLeft + tooltipNativeElement.offsetWidth - spacing < 0) {
            positionLeft = spacing;
        }
        if (positionTop + tooltipNativeElement.offsetHeight + spacing > this.platform.height()) {
            positionTop = this.platform.height() - tooltipNativeElement.offsetHeight - spacing;
        }
        else if (positionTop + tooltipNativeElement.offsetHeight - spacing < 0) {
            positionTop = spacing;
        }
        return {
            left: positionLeft,
            top: positionTop,
        };
    }
    /**
     * @return {?}
     */
    removeTooltip() {
        if (this._debouncedPromise) {
            clearTimeout(this._debouncedPromise);
            this._debouncedPromise = null;
        }
        if (!this._tooltipElement) {
            this._tooltipElement = undefined;
            this._tooltipTimeout = undefined;
            return;
        }
        this._tooltipElement.instance.fadeState = 'invisible';
        this.canShow = false;
        // wait for animation to finish then clear everything out
        setTimeout((/**
         * @return {?}
         */
        () => {
            if (this._tooltipElement &&
                typeof this._tooltipElement.destroy === 'function') {
                this._tooltipElement.destroy();
            }
            this.tooltipCtrl.removeTooltip(this);
            this._tooltipElement = this._tooltipTimeout = undefined;
            this.canShow = true;
        }), 300);
    }
    /**
     * @private
     * @return {?}
     */
    _resetTimer() {
        clearTimeout(this._tooltipTimeout);
        this._tooltipTimeout = setTimeout((/**
         * @return {?}
         */
        () => {
            this.active = false;
        }), this.duration);
    }
}
TooltipDirective.decorators = [
    { type: Directive, args: [{
                selector: '[tooltip]',
            },] }
];
/** @nocollapse */
TooltipDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: ApplicationRef },
    { type: Platform },
    { type: ComponentFactoryResolver },
    { type: TooltipController },
    { type: ViewContainerRef }
];
TooltipDirective.propDecorators = {
    debounce: [{ type: Input }],
    desktopEvent: [{ type: Input }],
    event: [{ type: Input }],
    hideOthers: [{ type: Input }],
    leftOffset: [{ type: Input }],
    mobileEvent: [{ type: Input }],
    positionV: [{ type: Input }],
    positionH: [{ type: Input }],
    role: [{ type: Input }],
    tooltip: [{ type: Input }],
    tooltipHtml: [{ type: Input }],
    tooltipStyles: [{ type: Input }],
    topOffset: [{ type: Input }],
    navTooltip: [{ type: Input }],
    arrow: [{ type: Input }],
    duration: [{ type: Input }],
    active: [{ type: Input }],
    onClick: [{ type: HostListener, args: ['click',] }],
    onPress: [{ type: HostListener, args: ['press',] }],
    onMouseEnter: [{ type: HostListener, args: ['mouseenter',] }],
    onMouseLeave: [{ type: HostListener, args: ['mouseleave',] }]
};
if (false) {
    /** @type {?} */
    TooltipDirective.prototype.debounce;
    /** @type {?} */
    TooltipDirective.prototype.desktopEvent;
    /** @type {?} */
    TooltipDirective.prototype.event;
    /** @type {?} */
    TooltipDirective.prototype.hideOthers;
    /** @type {?} */
    TooltipDirective.prototype.leftOffset;
    /** @type {?} */
    TooltipDirective.prototype.mobileEvent;
    /** @type {?} */
    TooltipDirective.prototype.positionV;
    /** @type {?} */
    TooltipDirective.prototype.positionH;
    /** @type {?} */
    TooltipDirective.prototype.role;
    /** @type {?} */
    TooltipDirective.prototype.tooltip;
    /** @type {?} */
    TooltipDirective.prototype.tooltipHtml;
    /** @type {?} */
    TooltipDirective.prototype.tooltipStyles;
    /** @type {?} */
    TooltipDirective.prototype.topOffset;
    /** @type {?} */
    TooltipDirective.prototype.duration;
    /**
     * @type {?}
     * @private
     */
    TooltipDirective.prototype._active;
    /**
     * @type {?}
     * @private
     */
    TooltipDirective.prototype._arrow;
    /**
     * @type {?}
     * @private
     */
    TooltipDirective.prototype._canShow;
    /**
     * @type {?}
     * @private
     */
    TooltipDirective.prototype._debouncedPromise;
    /**
     * @type {?}
     * @private
     */
    TooltipDirective.prototype._navTooltip;
    /**
     * @type {?}
     * @private
     */
    TooltipDirective.prototype._tooltipElement;
    /**
     * @type {?}
     * @private
     */
    TooltipDirective.prototype._tooltipTimeout;
    /**
     * @type {?}
     * @private
     */
    TooltipDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    TooltipDirective.prototype.appRef;
    /**
     * @type {?}
     * @private
     */
    TooltipDirective.prototype.platform;
    /**
     * @type {?}
     * @private
     */
    TooltipDirective.prototype.cfr;
    /**
     * @type {?}
     * @private
     */
    TooltipDirective.prototype.tooltipCtrl;
    /**
     * @type {?}
     * @private
     */
    TooltipDirective.prototype.vcr;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9vbHRpcC5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9pb25pYzQtdG9vbHRpcHMvIiwic291cmNlcyI6WyJkaXJlY3RpdmVzL3Rvb2x0aXAuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBRUwsY0FBYyxFQUNkLHdCQUF3QixFQUV4QixTQUFTLEVBQ1QsVUFBVSxFQUNWLFlBQVksRUFDWixLQUFLLEVBSUwsZ0JBQWdCLEdBQ2pCLE1BQU0sZUFBZSxDQUFDO0FBRXZCLE9BQU8sRUFBQyxRQUFRLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUV4QyxPQUFPLEVBQUMsVUFBVSxFQUFDLE1BQU0saURBQWlELENBQUM7QUFDM0UsT0FBTyxFQUFDLGlCQUFpQixFQUFDLE1BQU0sa0NBQWtDLENBQUM7QUFDbkUsT0FBTyxFQUFDLFlBQVksRUFBQyxNQUFNLCtCQUErQixDQUFDO0FBSzNELE1BQU0sT0FBTyxnQkFBZ0I7Ozs7Ozs7OztJQXVEM0IsWUFDVSxFQUFhLEVBQ2IsTUFBcUIsRUFDckIsUUFBaUIsRUFDakIsR0FBNEIsRUFDNUIsV0FBNkIsRUFDN0IsR0FBb0I7UUFMcEIsT0FBRSxHQUFGLEVBQUUsQ0FBVztRQUNiLFdBQU0sR0FBTixNQUFNLENBQWU7UUFDckIsYUFBUSxHQUFSLFFBQVEsQ0FBUztRQUNqQixRQUFHLEdBQUgsR0FBRyxDQUF5QjtRQUM1QixnQkFBVyxHQUFYLFdBQVcsQ0FBa0I7UUFDN0IsUUFBRyxHQUFILEdBQUcsQ0FBaUI7UUE1RHJCLGFBQVEsR0FBVSxDQUFDLENBQUM7UUFDcEIsaUJBQVksR0FBZ0IsWUFBWSxDQUFDLEtBQUssQ0FBQztRQVUvQyxrQkFBYSxHQUE0QixFQUFFLENBQUM7UUFxQjVDLGFBQVEsR0FBRyxJQUFJLENBQUM7UUFjakIsWUFBTyxHQUFXLEtBQUssQ0FBQztRQUN4QixXQUFNLEdBQVcsS0FBSyxDQUFDO1FBQ3ZCLGFBQVEsR0FBVyxJQUFJLENBQUM7UUFDeEIsc0JBQWlCLEdBQUcsSUFBSSxDQUFDO1FBQ3pCLGdCQUFXLEdBQVcsS0FBSyxDQUFDO0lBYXBDLENBQUM7Ozs7O0lBakRELElBQ0ksVUFBVSxDQUFDLEdBQVc7UUFDeEIsSUFBSSxDQUFDLFdBQVcsR0FBRyxPQUFPLEdBQUcsS0FBSyxTQUFTLElBQUksR0FBRyxLQUFLLEtBQUssQ0FBQztJQUMvRCxDQUFDOzs7O0lBRUQsSUFBSSxVQUFVO1FBQ1osT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDO0lBQzFCLENBQUM7Ozs7O0lBRUQsSUFDSSxLQUFLLENBQUMsR0FBVztRQUNuQixJQUFJLENBQUMsTUFBTSxHQUFHLE9BQU8sR0FBRyxLQUFLLFNBQVMsSUFBSSxHQUFHLEtBQUssS0FBSyxDQUFDO0lBQzFELENBQUM7Ozs7SUFFRCxJQUFJLEtBQUs7UUFDUCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDckIsQ0FBQzs7Ozs7SUFJRCxJQUNJLE1BQU0sQ0FBQyxHQUFXO1FBQ3BCLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxHQUFHLEtBQUssU0FBUyxJQUFJLEdBQUcsS0FBSyxLQUFLLENBQUM7UUFFekQsSUFBSSxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDNUIsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDOUMsQ0FBQzs7OztJQUVELElBQUksTUFBTTtRQUNSLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQztJQUN0QixDQUFDOzs7O0lBcUJELFFBQVE7UUFDTixJQUFJLE9BQU8sSUFBSSxDQUFDLEtBQUssS0FBSyxXQUFXLEVBQUU7WUFDckMsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO2dCQUN2QyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDO1NBQ3hDO1FBRUQsc0hBQXNIO1FBQ3RILGtCQUFrQjtRQUNsQixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDdkIsQ0FBQzs7Ozs7SUFLRCxlQUFlO1FBQ2IsSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ2hCLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztTQUNoQjtJQUNILENBQUM7Ozs7SUFFRCxXQUFXO1FBQ1QsSUFBSSxJQUFJLENBQUMsZUFBZSxJQUFJLE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQyxPQUFPLEtBQUssVUFBVSxFQUFFO1lBQzlFLElBQUksQ0FBQyxlQUFlLENBQUMsT0FBTyxFQUFFLENBQUM7U0FDaEM7SUFDSCxDQUFDOzs7Ozs7O0lBTUQsSUFBSSxPQUFPLENBQUMsSUFBYTtRQUN2QixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztJQUN2QixDQUFDOzs7O0lBS0QsSUFBSSxPQUFPO1FBQ1QsT0FBTyxJQUFJLENBQUMsUUFBUTtZQUNsQixDQUFDLENBQUMsT0FBTyxJQUFJLENBQUMsT0FBTyxLQUFLLFFBQVEsSUFBSSxJQUFJLENBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQzttQkFDckQsQ0FBQyxPQUFPLElBQUksQ0FBQyxXQUFXLEtBQUssUUFBUSxJQUFJLElBQUksQ0FBQyxXQUFXLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztJQUM1RSxDQUFDOzs7Ozs7SUFNRCxPQUFPO1FBQ0wsSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ2hCLElBQUksSUFBSSxDQUFDLGVBQWUsRUFBRTtnQkFDeEIsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO2FBQ3BCO2lCQUFNO2dCQUNMLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQzthQUNwQjtTQUNGO0lBQ0gsQ0FBQzs7Ozs7SUFLRCxXQUFXO1FBQ1QsSUFBSSxDQUFDLGlCQUFpQixHQUFHLFVBQVU7OztRQUNqQyxHQUFHLEVBQUU7WUFDSCxJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxDQUFDO1lBRTlCLElBQUksQ0FBQyx1QkFBdUIsRUFBRSxDQUFDOztrQkFFekIsZ0JBQWdCLEdBQWUsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRO1lBRWxFLGdCQUFnQixDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO1lBQ2xDLGdCQUFnQixDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDO1lBQ3JDLGdCQUFnQixDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDO1lBQ3BELGdCQUFnQixDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDO1lBQ2hELGdCQUFnQixDQUFDLElBQUksQ0FBQyxJQUFJOzs7WUFBQyxHQUFHLEVBQUU7O3NCQUN4QixlQUFlLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixFQUFFO2dCQUVsRCxnQkFBZ0IsQ0FBQyxPQUFPLEdBQUcsZUFBZSxDQUFDLElBQUksQ0FBQztnQkFDaEQsZ0JBQWdCLENBQUMsTUFBTSxHQUFHLGVBQWUsQ0FBQyxHQUFHLENBQUM7Z0JBRTlDLGdCQUFnQixDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUM7Z0JBRXZDLElBQUksSUFBSSxDQUFDLEtBQUssRUFBRTs7d0JBQ1YsYUFBYTtvQkFDakIsSUFBSSxJQUFJLENBQUMsU0FBUyxLQUFLLEtBQUssRUFBRTt3QkFDNUIsYUFBYSxHQUFHLFFBQVEsQ0FBQztxQkFDMUI7eUJBQU0sSUFBSSxJQUFJLENBQUMsU0FBUyxLQUFLLFFBQVEsRUFBRTt3QkFDdEMsYUFBYSxHQUFHLEtBQUssQ0FBQztxQkFDdkI7eUJBQU0sSUFBSSxJQUFJLENBQUMsU0FBUyxLQUFLLE1BQU0sRUFBRTt3QkFDcEMsYUFBYSxHQUFHLE9BQU8sQ0FBQztxQkFDekI7eUJBQU07d0JBQ0wsYUFBYSxHQUFHLE1BQU0sQ0FBQztxQkFDeEI7b0JBQ0QsZ0JBQWdCLENBQUMsS0FBSyxHQUFHLGFBQWEsQ0FBQztpQkFDeEM7Z0JBRUQsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUU7b0JBQ2pCLElBQUksQ0FBQyxlQUFlLEdBQUcsVUFBVSxDQUMvQixJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFDN0IsSUFBSSxDQUFDLFFBQVEsQ0FDZCxDQUFDO2lCQUNIO1lBQ0gsQ0FBQyxFQUFDLENBQUM7UUFDTCxDQUFDLEdBQ0QsSUFBSSxDQUFDLFFBQVEsQ0FDZCxDQUFDO0lBQ0osQ0FBQzs7OztJQUdELE9BQU87UUFDTCxJQUFJLElBQUksQ0FBQyxLQUFLLEtBQUssWUFBWSxDQUFDLEtBQUssRUFBRTtZQUNyQyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7U0FDaEI7SUFDSCxDQUFDOzs7O0lBR0QsT0FBTztRQUNMLElBQUksSUFBSSxDQUFDLEtBQUssS0FBSyxZQUFZLENBQUMsS0FBSyxFQUFFO1lBQ3JDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztTQUNoQjtJQUNILENBQUM7Ozs7SUFHRCxZQUFZO1FBQ1YsSUFBSSxJQUFJLENBQUMsS0FBSyxLQUFLLFlBQVksQ0FBQyxLQUFLLEVBQUU7WUFDckMsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7U0FDcEI7SUFDSCxDQUFDOzs7O0lBR0QsWUFBWTtRQUNWLElBQUksSUFBSSxDQUFDLEtBQUssS0FBSyxZQUFZLENBQUMsS0FBSyxFQUFFO1lBQ3JDLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDO1NBQ3JCO0lBQ0gsQ0FBQzs7Ozs7SUFFTyx1QkFBdUI7O2NBQ3ZCLGdCQUFnQixHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsdUJBQXVCLENBQUMsVUFBVSxDQUFDO1FBQ3JFLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxlQUFlLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUNsRSxJQUFJLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNwQyxDQUFDOzs7OztJQUVPLG1CQUFtQjs7Y0FDbkIsb0JBQW9CLEdBQWUsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsZ0JBQWdCLEVBQUU7O2NBQ3ZGLEVBQUUsR0FBZSxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWE7O2NBQ3RDLElBQUksR0FBYyxFQUFFLENBQUMscUJBQXFCLEVBQUU7O1lBRTFDLFlBQW1COztZQUNyQixXQUFrQjs7WUFDbEIsT0FBTyxHQUFHLEVBQUU7UUFFZCxJQUFJLElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDbkIsSUFBSSxDQUFDLFNBQVMsR0FBRyxRQUFRLENBQUM7WUFDMUIsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7WUFDbkIsT0FBTyxHQUFHLEVBQUUsQ0FBQztTQUNkO1FBRUQsSUFBSSxJQUFJLENBQUMsU0FBUyxLQUFLLE9BQU8sRUFBRTtZQUM5QixZQUFZLEdBQUcsSUFBSSxDQUFDLEtBQUssR0FBRyxPQUFPLENBQUM7U0FDckM7YUFBTSxJQUFJLElBQUksQ0FBQyxTQUFTLEtBQUssTUFBTSxFQUFFO1lBQ3BDLFlBQVksR0FBRyxJQUFJLENBQUMsSUFBSSxHQUFHLE9BQU8sR0FBRyxvQkFBb0IsQ0FBQyxXQUFXLENBQUM7WUFDdEUsVUFBVTtTQUNYO2FBQU0sSUFBSSxJQUFJLENBQUMsVUFBVSxFQUFFO1lBQzFCLFlBQVksR0FBRyxJQUFJLENBQUMsSUFBSSxHQUFHLEVBQUUsQ0FBQyxXQUFXLEdBQUcsQ0FBQyxDQUFDO1NBQy9DO2FBQU07WUFDTCxZQUFZLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztTQUMxQjtRQUdELElBQUksSUFBSSxDQUFDLFNBQVMsS0FBSyxLQUFLLEVBQUU7WUFDNUIsV0FBVyxHQUFHLElBQUksQ0FBQyxHQUFHLEdBQUcsT0FBTyxHQUFHLG9CQUFvQixDQUFDLFlBQVksQ0FBQztTQUN0RTthQUFNLElBQUksSUFBSSxDQUFDLFNBQVMsS0FBSyxRQUFRLEVBQUU7WUFDdEMsV0FBVyxHQUFHLElBQUksQ0FBQyxNQUFNLEdBQUcsT0FBTyxDQUFDO1NBQ3JDO2FBQU07WUFDTCxXQUFXLEdBQUcsSUFBSSxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUMsWUFBWSxHQUFHLENBQUMsR0FBRyxvQkFBb0IsQ0FBQyxZQUFZLEdBQUcsQ0FBQyxDQUFDO1NBQ3RGO1FBRUQsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQ2pCLElBQUksSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUNsQixXQUFXLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDO1NBQ2hDO1FBRUQsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQ2xCLElBQUksSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUNuQixZQUFZLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDO1NBQ2xDO1FBRUQsSUFBSSxZQUFZLEdBQUcsb0JBQW9CLENBQUMsV0FBVyxHQUFHLE9BQU8sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRSxFQUFFO1lBQ3JGLFlBQVksR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRSxHQUFHLG9CQUFvQixDQUFDLFdBQVcsR0FBRyxPQUFPLENBQUM7U0FDbkY7YUFBTSxJQUFJLFlBQVksR0FBRyxvQkFBb0IsQ0FBQyxXQUFXLEdBQUcsT0FBTyxHQUFHLENBQUMsRUFBRTtZQUN4RSxZQUFZLEdBQUcsT0FBTyxDQUFDO1NBQ3hCO1FBRUQsSUFBSSxXQUFXLEdBQUcsb0JBQW9CLENBQUMsWUFBWSxHQUFHLE9BQU8sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxFQUFFO1lBQ3RGLFdBQVcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxHQUFHLG9CQUFvQixDQUFDLFlBQVksR0FBRyxPQUFPLENBQUM7U0FDcEY7YUFBTSxJQUFJLFdBQVcsR0FBRyxvQkFBb0IsQ0FBQyxZQUFZLEdBQUcsT0FBTyxHQUFHLENBQUMsRUFBRTtZQUN4RSxXQUFXLEdBQUcsT0FBTyxDQUFDO1NBQ3ZCO1FBRUQsT0FBTztZQUNMLElBQUksRUFBRSxZQUFZO1lBQ2xCLEdBQUcsRUFBRyxXQUFXO1NBQ2xCLENBQUM7SUFDSixDQUFDOzs7O0lBRUQsYUFBYTtRQUNYLElBQUksSUFBSSxDQUFDLGlCQUFpQixFQUFFO1lBQzFCLFlBQVksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQztZQUVyQyxJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxDQUFDO1NBQy9CO1FBRUQsSUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUU7WUFDekIsSUFBSSxDQUFDLGVBQWUsR0FBRyxTQUFTLENBQUM7WUFDakMsSUFBSSxDQUFDLGVBQWUsR0FBRyxTQUFTLENBQUM7WUFDakMsT0FBTztTQUNSO1FBRUQsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsU0FBUyxHQUFHLFdBQVcsQ0FBQztRQUV0RCxJQUFJLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQztRQUVyQix5REFBeUQ7UUFDekQsVUFBVTs7O1FBQ1IsR0FBRyxFQUFFO1lBQ0gsSUFDRSxJQUFJLENBQUMsZUFBZTtnQkFDcEIsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDLE9BQU8sS0FBSyxVQUFVLEVBQ2xEO2dCQUNBLElBQUksQ0FBQyxlQUFlLENBQUMsT0FBTyxFQUFFLENBQUM7YUFDaEM7WUFDRCxJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNyQyxJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQyxlQUFlLEdBQUcsU0FBUyxDQUFDO1lBQ3hELElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO1FBQ3RCLENBQUMsR0FDRCxHQUFHLENBQ0osQ0FBQztJQUNKLENBQUM7Ozs7O0lBRU8sV0FBVztRQUNqQixZQUFZLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO1FBQ25DLElBQUksQ0FBQyxlQUFlLEdBQUcsVUFBVTs7O1FBQUMsR0FBRyxFQUFFO1lBQ3JDLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDO1FBQ3RCLENBQUMsR0FBRSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDcEIsQ0FBQzs7O1lBeFRGLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsV0FBVzthQUN0Qjs7OztZQWpCQyxVQUFVO1lBSlYsY0FBYztZQWFSLFFBQVE7WUFaZCx3QkFBd0I7WUFlbEIsaUJBQWlCO1lBTnZCLGdCQUFnQjs7O3VCQWFmLEtBQUs7MkJBQ0wsS0FBSztvQkFDTCxLQUFLO3lCQUNMLEtBQUs7eUJBQ0wsS0FBSzswQkFDTCxLQUFLO3dCQUNMLEtBQUs7d0JBQ0wsS0FBSzttQkFDTCxLQUFLO3NCQUNMLEtBQUs7MEJBQ0wsS0FBSzs0QkFDTCxLQUFLO3dCQUNMLEtBQUs7eUJBRUwsS0FBSztvQkFTTCxLQUFLO3VCQVNMLEtBQUs7cUJBRUwsS0FBSztzQkEwSUwsWUFBWSxTQUFDLE9BQU87c0JBT3BCLFlBQVksU0FBQyxPQUFPOzJCQU9wQixZQUFZLFNBQUMsWUFBWTsyQkFPekIsWUFBWSxTQUFDLFlBQVk7Ozs7SUFqTTFCLG9DQUE2Qjs7SUFDN0Isd0NBQXdEOztJQUN4RCxpQ0FBNEI7O0lBQzVCLHNDQUE0Qjs7SUFDNUIsc0NBQTJCOztJQUMzQix1Q0FBa0M7O0lBQ2xDLHFDQUEwQjs7SUFDMUIscUNBQTBCOztJQUMxQixnQ0FBcUI7O0lBQ3JCLG1DQUF3Qjs7SUFDeEIsdUNBQTRCOztJQUM1Qix5Q0FBcUQ7O0lBQ3JELHFDQUEwQjs7SUFvQjFCLG9DQUF5Qjs7Ozs7SUFjekIsbUNBQWdDOzs7OztJQUNoQyxrQ0FBK0I7Ozs7O0lBQy9CLG9DQUFnQzs7Ozs7SUFDaEMsNkNBQWlDOzs7OztJQUNqQyx1Q0FBb0M7Ozs7O0lBQ3BDLDJDQUFpRDs7Ozs7SUFDakQsMkNBQTRCOzs7OztJQUcxQiw4QkFBcUI7Ozs7O0lBQ3JCLGtDQUE2Qjs7Ozs7SUFDN0Isb0NBQXlCOzs7OztJQUN6QiwrQkFBb0M7Ozs7O0lBQ3BDLHVDQUFxQzs7Ozs7SUFDckMsK0JBQTRCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgQXBwbGljYXRpb25SZWYsXG4gIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcbiAgQ29tcG9uZW50UmVmLFxuICBEaXJlY3RpdmUsXG4gIEVsZW1lbnRSZWYsXG4gIEhvc3RMaXN0ZW5lcixcbiAgSW5wdXQsXG4gIE9uRGVzdHJveSxcbiAgT25Jbml0LFxuICBSZW5kZXJlcjIsXG4gIFZpZXdDb250YWluZXJSZWYsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQge1BsYXRmb3JtfSBmcm9tICdAaW9uaWMvYW5ndWxhcic7XG5cbmltcG9ydCB7VG9vbHRpcEJveH0gZnJvbSAnLi4vY29tcG9uZW50cy90b29sdGlwLWJveC90b29sdGlwLWJveC5jb21wb25lbnQnO1xuaW1wb3J0IHtUb29sdGlwQ29udHJvbGxlcn0gZnJvbSAnLi4vY29udHJvbGxlcnMvdG9vbHRpcC5jb3Ryb2xsZXInO1xuaW1wb3J0IHtUb29sdGlwRXZlbnR9IGZyb20gJy4uL21vZGVscy90b29sdGlwLWV2ZW50Lm1vZGVsJztcblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnW3Rvb2x0aXBdJyxcbn0pXG5leHBvcnQgY2xhc3MgVG9vbHRpcERpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95IHtcbiAgQElucHV0KCkgZGVib3VuY2U6bnVtYmVyID0gMDtcbiAgQElucHV0KCkgZGVza3RvcEV2ZW50OlRvb2x0aXBFdmVudCA9IFRvb2x0aXBFdmVudC5IT1ZFUjtcbiAgQElucHV0KCkgZXZlbnQ6VG9vbHRpcEV2ZW50O1xuICBASW5wdXQoKSBoaWRlT3RoZXJzOmJvb2xlYW47XG4gIEBJbnB1dCgpIGxlZnRPZmZzZXQ6bnVtYmVyO1xuICBASW5wdXQoKSBtb2JpbGVFdmVudDpUb29sdGlwRXZlbnQ7XG4gIEBJbnB1dCgpIHBvc2l0aW9uVjpzdHJpbmc7XG4gIEBJbnB1dCgpIHBvc2l0aW9uSDpzdHJpbmc7XG4gIEBJbnB1dCgpIHJvbGU6c3RyaW5nO1xuICBASW5wdXQoKSB0b29sdGlwOnN0cmluZztcbiAgQElucHV0KCkgdG9vbHRpcEh0bWw6c3RyaW5nO1xuICBASW5wdXQoKSB0b29sdGlwU3R5bGVzOnsgW2tleTpzdHJpbmddOnN0cmluZzsgfSA9IHt9O1xuICBASW5wdXQoKSB0b3BPZmZzZXQ6bnVtYmVyO1xuXG4gIEBJbnB1dCgpXG4gIHNldCBuYXZUb29sdGlwKHZhbDpib29sZWFuKSB7XG4gICAgdGhpcy5fbmF2VG9vbHRpcCA9IHR5cGVvZiB2YWwgIT09ICdib29sZWFuJyB8fCB2YWwgIT09IGZhbHNlO1xuICB9XG5cbiAgZ2V0IG5hdlRvb2x0aXAoKTpib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5fbmF2VG9vbHRpcDtcbiAgfVxuXG4gIEBJbnB1dCgpXG4gIHNldCBhcnJvdyh2YWw6Ym9vbGVhbikge1xuICAgIHRoaXMuX2Fycm93ID0gdHlwZW9mIHZhbCAhPT0gJ2Jvb2xlYW4nIHx8IHZhbCAhPT0gZmFsc2U7XG4gIH1cblxuICBnZXQgYXJyb3coKTpib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5fYXJyb3c7XG4gIH1cblxuICBASW5wdXQoKSBkdXJhdGlvbiA9IDMwMDA7XG5cbiAgQElucHV0KClcbiAgc2V0IGFjdGl2ZSh2YWw6Ym9vbGVhbikge1xuICAgIHRoaXMuX2FjdGl2ZSA9IHR5cGVvZiB2YWwgIT09ICdib29sZWFuJyB8fCB2YWwgIT09IGZhbHNlO1xuXG4gICAgdGhpcy5fYWN0aXZlICYmIHRoaXMuY2FuU2hvdyA/XG4gICAgICB0aGlzLnNob3dUb29sdGlwKCkgOiB0aGlzLnJlbW92ZVRvb2x0aXAoKTtcbiAgfVxuXG4gIGdldCBhY3RpdmUoKTpib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5fYWN0aXZlO1xuICB9XG5cbiAgcHJpdmF0ZSBfYWN0aXZlOmJvb2xlYW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBfYXJyb3c6Ym9vbGVhbiA9IGZhbHNlO1xuICBwcml2YXRlIF9jYW5TaG93OmJvb2xlYW4gPSB0cnVlO1xuICBwcml2YXRlIF9kZWJvdW5jZWRQcm9taXNlID0gbnVsbDtcbiAgcHJpdmF0ZSBfbmF2VG9vbHRpcDpib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgX3Rvb2x0aXBFbGVtZW50OkNvbXBvbmVudFJlZjxUb29sdGlwQm94PjtcbiAgcHJpdmF0ZSBfdG9vbHRpcFRpbWVvdXQ6YW55O1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgZWw6RWxlbWVudFJlZixcbiAgICBwcml2YXRlIGFwcFJlZjpBcHBsaWNhdGlvblJlZixcbiAgICBwcml2YXRlIHBsYXRmb3JtOlBsYXRmb3JtLFxuICAgIHByaXZhdGUgY2ZyOkNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcbiAgICBwcml2YXRlIHRvb2x0aXBDdHJsOlRvb2x0aXBDb250cm9sbGVyLFxuICAgIHByaXZhdGUgdmNyOlZpZXdDb250YWluZXJSZWYsXG4gICkge1xuXG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICBpZiAodHlwZW9mIHRoaXMuZXZlbnQgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICB0aGlzLmV2ZW50ID0gdGhpcy5wbGF0Zm9ybS5pcygnbW9iaWxlJykgP1xuICAgICAgICB0aGlzLm1vYmlsZUV2ZW50IDogdGhpcy5kZXNrdG9wRXZlbnQ7XG4gICAgfVxuXG4gICAgLy8gaWYgdGhlIHRpbWVyIGhhc24ndCBleHBpcmVkIG9yIGFjdGl2ZSBpcyB0cnVlIHdoZW4gdGhlIGNvbXBvbmVudCBnZXRzIGRlc3Ryb3llZCwgdGhlIHRvb2x0aXAgd2lsbCByZW1haW4gaW4gdGhlIERPTVxuICAgIC8vIHRoaXMgcmVtb3ZlcyBpdFxuICAgIHRoaXMucmVtb3ZlVG9vbHRpcCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNob3cgdGhlIHRvb2x0aXAgaW1tZWRpYXRlbHkgYWZ0ZXIgaW5pdGlhdGluZyB2aWV3IGlmIHNldCB0b1xuICAgKi9cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIGlmICh0aGlzLl9hY3RpdmUpIHtcbiAgICAgIHRoaXMudHJpZ2dlcigpO1xuICAgIH1cbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIGlmICh0aGlzLl90b29sdGlwRWxlbWVudCAmJiB0eXBlb2YgdGhpcy5fdG9vbHRpcEVsZW1lbnQuZGVzdHJveSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgdGhpcy5fdG9vbHRpcEVsZW1lbnQuZGVzdHJveSgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgdGhlIGNhblNob3cgcHJvcGVydHlcbiAgICogRW5zdXJlIHRoYXQgdG9vbHRpcCBpcyBzaG93biBvbmx5IGlmIHRoZSB0b29sdGlwIHN0cmluZyBpcyBub3QgZmFsc2V5XG4gICAqL1xuICBzZXQgY2FuU2hvdyhzaG93OiBib29sZWFuKSB7XG4gICAgdGhpcy5fY2FuU2hvdyA9IHNob3c7XG4gIH1cblxuICAvKipcbiAgICogQHJldHVybiBUUlVFIGlmIHRoZSB0b29sdGlwIGNhbiBiZSBzaG93blxuICAgKi9cbiAgZ2V0IGNhblNob3coKTpib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5fY2FuU2hvdyAmJlxuICAgICAgKCh0eXBlb2YgdGhpcy50b29sdGlwID09PSAnc3RyaW5nJyAmJiB0aGlzLnRvb2x0aXAgIT09ICcnKVxuICAgICAgICB8fCAodHlwZW9mIHRoaXMudG9vbHRpcEh0bWwgPT09ICdzdHJpbmcnICYmIHRoaXMudG9vbHRpcEh0bWwgIT09ICcnKSk7XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlcyB0aGUgY2xpY2svcHJlc3MgZXZlbnQgYW5kIHNob3dzIGEgdG9vbHRpcC5cbiAgICogSWYgYSB0b29sdGlwIGFscmVhZHkgZXhpc3RzLCBpdCB3aWxsIGp1c3QgcmVzZXQgaXQncyB0aW1lci5cbiAgICovXG4gIHRyaWdnZXIoKTp2b2lkIHtcbiAgICBpZiAodGhpcy5jYW5TaG93KSB7XG4gICAgICBpZiAodGhpcy5fdG9vbHRpcEVsZW1lbnQpIHtcbiAgICAgICAgdGhpcy5fcmVzZXRUaW1lcigpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zaG93VG9vbHRpcCgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgbmV3IHRvb2x0aXAgY29tcG9uZW50IGFuZCBhZGp1c3RzIGl0J3MgcHJvcGVydGllcyB0byBzaG93IHByb3Blcmx5LlxuICAgKi9cbiAgc2hvd1Rvb2x0aXAoKTp2b2lkIHtcbiAgICB0aGlzLl9kZWJvdW5jZWRQcm9taXNlID0gc2V0VGltZW91dChcbiAgICAgICgpID0+IHtcbiAgICAgICAgdGhpcy5fZGVib3VuY2VkUHJvbWlzZSA9IG51bGw7XG5cbiAgICAgICAgdGhpcy5fY3JlYXRlVG9vbHRpcENvbXBvbmVudCgpO1xuXG4gICAgICAgIGNvbnN0IHRvb2x0aXBDb21wb25lbnQ6IFRvb2x0aXBCb3ggPSB0aGlzLl90b29sdGlwRWxlbWVudC5pbnN0YW5jZTtcblxuICAgICAgICB0b29sdGlwQ29tcG9uZW50LnJvbGUgPSB0aGlzLnJvbGU7XG4gICAgICAgIHRvb2x0aXBDb21wb25lbnQudGV4dCA9IHRoaXMudG9vbHRpcDtcbiAgICAgICAgdG9vbHRpcENvbXBvbmVudC50b29sdGlwU3R5bGVzID0gdGhpcy50b29sdGlwU3R5bGVzO1xuICAgICAgICB0b29sdGlwQ29tcG9uZW50LnRvb2x0aXBIdG1sID0gdGhpcy50b29sdGlwSHRtbDtcbiAgICAgICAgdG9vbHRpcENvbXBvbmVudC5pbml0LnRoZW4oKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHRvb2x0aXBQb3NpdGlvbiA9IHRoaXMuX2dldFRvb2x0aXBQb3NpdGlvbigpO1xuXG4gICAgICAgICAgdG9vbHRpcENvbXBvbmVudC5wb3NMZWZ0ID0gdG9vbHRpcFBvc2l0aW9uLmxlZnQ7XG4gICAgICAgICAgdG9vbHRpcENvbXBvbmVudC5wb3NUb3AgPSB0b29sdGlwUG9zaXRpb24udG9wO1xuXG4gICAgICAgICAgdG9vbHRpcENvbXBvbmVudC5mYWRlU3RhdGUgPSAndmlzaWJsZSc7XG5cbiAgICAgICAgICBpZiAodGhpcy5hcnJvdykge1xuICAgICAgICAgICAgbGV0IGFycm93UG9zaXRpb247XG4gICAgICAgICAgICBpZiAodGhpcy5wb3NpdGlvblYgPT09ICd0b3AnKSB7XG4gICAgICAgICAgICAgIGFycm93UG9zaXRpb24gPSAnYm90dG9tJztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5wb3NpdGlvblYgPT09ICdib3R0b20nKSB7XG4gICAgICAgICAgICAgIGFycm93UG9zaXRpb24gPSAndG9wJztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5wb3NpdGlvbkggPT09ICdsZWZ0Jykge1xuICAgICAgICAgICAgICBhcnJvd1Bvc2l0aW9uID0gJ3JpZ2h0JztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGFycm93UG9zaXRpb24gPSAnbGVmdCc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0b29sdGlwQ29tcG9uZW50LmFycm93ID0gYXJyb3dQb3NpdGlvbjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoIXRoaXMuX2FjdGl2ZSkge1xuICAgICAgICAgICAgdGhpcy5fdG9vbHRpcFRpbWVvdXQgPSBzZXRUaW1lb3V0KFxuICAgICAgICAgICAgICB0aGlzLnJlbW92ZVRvb2x0aXAuYmluZCh0aGlzKSxcbiAgICAgICAgICAgICAgdGhpcy5kdXJhdGlvbixcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgICB0aGlzLmRlYm91bmNlXG4gICAgKTtcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ2NsaWNrJylcbiAgb25DbGljaygpOnZvaWQge1xuICAgIGlmICh0aGlzLmV2ZW50ID09PSBUb29sdGlwRXZlbnQuQ0xJQ0spIHtcbiAgICAgIHRoaXMudHJpZ2dlcigpO1xuICAgIH1cbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ3ByZXNzJylcbiAgb25QcmVzcygpOnZvaWQge1xuICAgIGlmICh0aGlzLmV2ZW50ID09PSBUb29sdGlwRXZlbnQuUFJFU1MpIHtcbiAgICAgIHRoaXMudHJpZ2dlcigpO1xuICAgIH1cbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ21vdXNlZW50ZXInKVxuICBvbk1vdXNlRW50ZXIoKTp2b2lkIHtcbiAgICBpZiAodGhpcy5ldmVudCA9PT0gVG9vbHRpcEV2ZW50LkhPVkVSKSB7XG4gICAgICB0aGlzLmFjdGl2ZSA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgQEhvc3RMaXN0ZW5lcignbW91c2VsZWF2ZScpXG4gIG9uTW91c2VMZWF2ZSgpOnZvaWQge1xuICAgIGlmICh0aGlzLmV2ZW50ID09PSBUb29sdGlwRXZlbnQuSE9WRVIpIHtcbiAgICAgIHRoaXMuYWN0aXZlID0gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBfY3JlYXRlVG9vbHRpcENvbXBvbmVudCgpIHtcbiAgICBjb25zdCBjb21wb25lbnRGYWN0b3J5ID0gdGhpcy5jZnIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoVG9vbHRpcEJveCk7XG4gICAgdGhpcy5fdG9vbHRpcEVsZW1lbnQgPSB0aGlzLnZjci5jcmVhdGVDb21wb25lbnQoY29tcG9uZW50RmFjdG9yeSk7XG4gICAgdGhpcy50b29sdGlwQ3RybC5hZGRUb29sdGlwKHRoaXMpO1xuICB9XG5cbiAgcHJpdmF0ZSBfZ2V0VG9vbHRpcFBvc2l0aW9uKCkge1xuICAgIGNvbnN0IHRvb2x0aXBOYXRpdmVFbGVtZW50OkhUTUxFbGVtZW50ID0gdGhpcy5fdG9vbHRpcEVsZW1lbnQuaW5zdGFuY2UuZ2V0TmF0aXZlRWxlbWVudCgpLFxuICAgICAgZWw6SFRNTEVsZW1lbnQgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsXG4gICAgICByZWN0OkNsaWVudFJlY3QgPSBlbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgIGxldCBwb3NpdGlvbkxlZnQ6bnVtYmVyLFxuICAgICAgcG9zaXRpb25Ub3A6bnVtYmVyLFxuICAgICAgc3BhY2luZyA9IDEwO1xuXG4gICAgaWYgKHRoaXMubmF2VG9vbHRpcCkge1xuICAgICAgdGhpcy5wb3NpdGlvblYgPSAnYm90dG9tJztcbiAgICAgIHRoaXMuYXJyb3cgPSBmYWxzZTtcbiAgICAgIHNwYWNpbmcgPSAyMDtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5wb3NpdGlvbkggPT09ICdyaWdodCcpIHtcbiAgICAgIHBvc2l0aW9uTGVmdCA9IHJlY3QucmlnaHQgKyBzcGFjaW5nO1xuICAgIH0gZWxzZSBpZiAodGhpcy5wb3NpdGlvbkggPT09ICdsZWZ0Jykge1xuICAgICAgcG9zaXRpb25MZWZ0ID0gcmVjdC5sZWZ0IC0gc3BhY2luZyAtIHRvb2x0aXBOYXRpdmVFbGVtZW50Lm9mZnNldFdpZHRoO1xuICAgICAgLy8gLTc5LCAxOVxuICAgIH0gZWxzZSBpZiAodGhpcy5uYXZUb29sdGlwKSB7XG4gICAgICBwb3NpdGlvbkxlZnQgPSByZWN0LmxlZnQgKyBlbC5vZmZzZXRXaWR0aCAvIDI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHBvc2l0aW9uTGVmdCA9IHJlY3QubGVmdDtcbiAgICB9XG5cblxuICAgIGlmICh0aGlzLnBvc2l0aW9uViA9PT0gJ3RvcCcpIHtcbiAgICAgIHBvc2l0aW9uVG9wID0gcmVjdC50b3AgLSBzcGFjaW5nIC0gdG9vbHRpcE5hdGl2ZUVsZW1lbnQub2Zmc2V0SGVpZ2h0O1xuICAgIH0gZWxzZSBpZiAodGhpcy5wb3NpdGlvblYgPT09ICdib3R0b20nKSB7XG4gICAgICBwb3NpdGlvblRvcCA9IHJlY3QuYm90dG9tICsgc3BhY2luZztcbiAgICB9IGVsc2Uge1xuICAgICAgcG9zaXRpb25Ub3AgPSByZWN0LnRvcCArIGVsLm9mZnNldEhlaWdodCAvIDIgLSB0b29sdGlwTmF0aXZlRWxlbWVudC5vZmZzZXRIZWlnaHQgLyAyO1xuICAgIH1cblxuICAgIHRoaXMudG9wT2Zmc2V0Kys7XG4gICAgaWYgKHRoaXMudG9wT2Zmc2V0KSB7XG4gICAgICBwb3NpdGlvblRvcCArPSArdGhpcy50b3BPZmZzZXQ7XG4gICAgfVxuXG4gICAgdGhpcy5sZWZ0T2Zmc2V0Kys7XG4gICAgaWYgKHRoaXMubGVmdE9mZnNldCkge1xuICAgICAgcG9zaXRpb25MZWZ0ICs9ICt0aGlzLmxlZnRPZmZzZXQ7XG4gICAgfVxuXG4gICAgaWYgKHBvc2l0aW9uTGVmdCArIHRvb2x0aXBOYXRpdmVFbGVtZW50Lm9mZnNldFdpZHRoICsgc3BhY2luZyA+IHRoaXMucGxhdGZvcm0ud2lkdGgoKSkge1xuICAgICAgcG9zaXRpb25MZWZ0ID0gdGhpcy5wbGF0Zm9ybS53aWR0aCgpIC0gdG9vbHRpcE5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGggLSBzcGFjaW5nO1xuICAgIH0gZWxzZSBpZiAocG9zaXRpb25MZWZ0ICsgdG9vbHRpcE5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGggLSBzcGFjaW5nIDwgMCkge1xuICAgICAgcG9zaXRpb25MZWZ0ID0gc3BhY2luZztcbiAgICB9XG5cbiAgICBpZiAocG9zaXRpb25Ub3AgKyB0b29sdGlwTmF0aXZlRWxlbWVudC5vZmZzZXRIZWlnaHQgKyBzcGFjaW5nID4gdGhpcy5wbGF0Zm9ybS5oZWlnaHQoKSkge1xuICAgICAgcG9zaXRpb25Ub3AgPSB0aGlzLnBsYXRmb3JtLmhlaWdodCgpIC0gdG9vbHRpcE5hdGl2ZUVsZW1lbnQub2Zmc2V0SGVpZ2h0IC0gc3BhY2luZztcbiAgICB9IGVsc2UgaWYgKHBvc2l0aW9uVG9wICsgdG9vbHRpcE5hdGl2ZUVsZW1lbnQub2Zmc2V0SGVpZ2h0IC0gc3BhY2luZyA8IDApIHtcbiAgICAgIHBvc2l0aW9uVG9wID0gc3BhY2luZztcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgbGVmdDogcG9zaXRpb25MZWZ0LFxuICAgICAgdG9wOiAgcG9zaXRpb25Ub3AsXG4gICAgfTtcbiAgfVxuXG4gIHJlbW92ZVRvb2x0aXAoKSB7XG4gICAgaWYgKHRoaXMuX2RlYm91bmNlZFByb21pc2UpIHtcbiAgICAgIGNsZWFyVGltZW91dCh0aGlzLl9kZWJvdW5jZWRQcm9taXNlKTtcblxuICAgICAgdGhpcy5fZGVib3VuY2VkUHJvbWlzZSA9IG51bGw7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLl90b29sdGlwRWxlbWVudCkge1xuICAgICAgdGhpcy5fdG9vbHRpcEVsZW1lbnQgPSB1bmRlZmluZWQ7XG4gICAgICB0aGlzLl90b29sdGlwVGltZW91dCA9IHVuZGVmaW5lZDtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLl90b29sdGlwRWxlbWVudC5pbnN0YW5jZS5mYWRlU3RhdGUgPSAnaW52aXNpYmxlJztcblxuICAgIHRoaXMuY2FuU2hvdyA9IGZhbHNlO1xuXG4gICAgLy8gd2FpdCBmb3IgYW5pbWF0aW9uIHRvIGZpbmlzaCB0aGVuIGNsZWFyIGV2ZXJ5dGhpbmcgb3V0XG4gICAgc2V0VGltZW91dChcbiAgICAgICgpID0+IHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIHRoaXMuX3Rvb2x0aXBFbGVtZW50ICYmXG4gICAgICAgICAgdHlwZW9mIHRoaXMuX3Rvb2x0aXBFbGVtZW50LmRlc3Ryb3kgPT09ICdmdW5jdGlvbidcbiAgICAgICAgKSB7XG4gICAgICAgICAgdGhpcy5fdG9vbHRpcEVsZW1lbnQuZGVzdHJveSgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudG9vbHRpcEN0cmwucmVtb3ZlVG9vbHRpcCh0aGlzKTtcbiAgICAgICAgdGhpcy5fdG9vbHRpcEVsZW1lbnQgPSB0aGlzLl90b29sdGlwVGltZW91dCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5jYW5TaG93ID0gdHJ1ZTtcbiAgICAgIH0sXG4gICAgICAzMDBcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBfcmVzZXRUaW1lcigpOnZvaWQge1xuICAgIGNsZWFyVGltZW91dCh0aGlzLl90b29sdGlwVGltZW91dCk7XG4gICAgdGhpcy5fdG9vbHRpcFRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMuYWN0aXZlID0gZmFsc2U7XG4gICAgfSwgdGhpcy5kdXJhdGlvbik7XG4gIH1cbn1cbiJdfQ==