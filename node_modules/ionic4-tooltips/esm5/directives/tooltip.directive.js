/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ApplicationRef, ComponentFactoryResolver, Directive, ElementRef, HostListener, Input, ViewContainerRef, } from '@angular/core';
import { Platform } from '@ionic/angular';
import { TooltipBox } from '../components/tooltip-box/tooltip-box.component';
import { TooltipController } from '../controllers/tooltip.cotroller';
import { TooltipEvent } from '../models/tooltip-event.model';
var TooltipDirective = /** @class */ (function () {
    function TooltipDirective(el, appRef, platform, cfr, tooltipCtrl, vcr) {
        this.el = el;
        this.appRef = appRef;
        this.platform = platform;
        this.cfr = cfr;
        this.tooltipCtrl = tooltipCtrl;
        this.vcr = vcr;
        this.debounce = 0;
        this.desktopEvent = TooltipEvent.HOVER;
        this.tooltipStyles = {};
        this.duration = 3000;
        this._active = false;
        this._arrow = false;
        this._canShow = true;
        this._debouncedPromise = null;
        this._navTooltip = false;
    }
    Object.defineProperty(TooltipDirective.prototype, "navTooltip", {
        get: /**
         * @return {?}
         */
        function () {
            return this._navTooltip;
        },
        set: /**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            this._navTooltip = typeof val !== 'boolean' || val !== false;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TooltipDirective.prototype, "arrow", {
        get: /**
         * @return {?}
         */
        function () {
            return this._arrow;
        },
        set: /**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            this._arrow = typeof val !== 'boolean' || val !== false;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TooltipDirective.prototype, "active", {
        get: /**
         * @return {?}
         */
        function () {
            return this._active;
        },
        set: /**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            this._active = typeof val !== 'boolean' || val !== false;
            this._active && this.canShow ?
                this.showTooltip() : this.removeTooltip();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    TooltipDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        if (typeof this.event === 'undefined') {
            this.event = this.platform.is('mobile') ?
                this.mobileEvent : this.desktopEvent;
        }
        // if the timer hasn't expired or active is true when the component gets destroyed, the tooltip will remain in the DOM
        // this removes it
        this.removeTooltip();
    };
    /**
     * Show the tooltip immediately after initiating view if set to
     */
    /**
     * Show the tooltip immediately after initiating view if set to
     * @return {?}
     */
    TooltipDirective.prototype.ngAfterViewInit = /**
     * Show the tooltip immediately after initiating view if set to
     * @return {?}
     */
    function () {
        if (this._active) {
            this.trigger();
        }
    };
    /**
     * @return {?}
     */
    TooltipDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this._tooltipElement && typeof this._tooltipElement.destroy === 'function') {
            this._tooltipElement.destroy();
        }
    };
    Object.defineProperty(TooltipDirective.prototype, "canShow", {
        /**
         * @return TRUE if the tooltip can be shown
         */
        get: /**
         * @return {?} TRUE if the tooltip can be shown
         */
        function () {
            return this._canShow &&
                ((typeof this.tooltip === 'string' && this.tooltip !== '')
                    || (typeof this.tooltipHtml === 'string' && this.tooltipHtml !== ''));
        },
        /**
         * Set the canShow property
         * Ensure that tooltip is shown only if the tooltip string is not falsey
         */
        set: /**
         * Set the canShow property
         * Ensure that tooltip is shown only if the tooltip string is not falsey
         * @param {?} show
         * @return {?}
         */
        function (show) {
            this._canShow = show;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Handles the click/press event and shows a tooltip.
     * If a tooltip already exists, it will just reset it's timer.
     */
    /**
     * Handles the click/press event and shows a tooltip.
     * If a tooltip already exists, it will just reset it's timer.
     * @return {?}
     */
    TooltipDirective.prototype.trigger = /**
     * Handles the click/press event and shows a tooltip.
     * If a tooltip already exists, it will just reset it's timer.
     * @return {?}
     */
    function () {
        if (this.canShow) {
            if (this._tooltipElement) {
                this._resetTimer();
            }
            else {
                this.showTooltip();
            }
        }
    };
    /**
     * Creates a new tooltip component and adjusts it's properties to show properly.
     */
    /**
     * Creates a new tooltip component and adjusts it's properties to show properly.
     * @return {?}
     */
    TooltipDirective.prototype.showTooltip = /**
     * Creates a new tooltip component and adjusts it's properties to show properly.
     * @return {?}
     */
    function () {
        var _this = this;
        this._debouncedPromise = setTimeout((/**
         * @return {?}
         */
        function () {
            _this._debouncedPromise = null;
            _this._createTooltipComponent();
            /** @type {?} */
            var tooltipComponent = _this._tooltipElement.instance;
            tooltipComponent.role = _this.role;
            tooltipComponent.text = _this.tooltip;
            tooltipComponent.tooltipStyles = _this.tooltipStyles;
            tooltipComponent.tooltipHtml = _this.tooltipHtml;
            tooltipComponent.init.then((/**
             * @return {?}
             */
            function () {
                /** @type {?} */
                var tooltipPosition = _this._getTooltipPosition();
                tooltipComponent.posLeft = tooltipPosition.left;
                tooltipComponent.posTop = tooltipPosition.top;
                tooltipComponent.fadeState = 'visible';
                if (_this.arrow) {
                    /** @type {?} */
                    var arrowPosition = void 0;
                    if (_this.positionV === 'top') {
                        arrowPosition = 'bottom';
                    }
                    else if (_this.positionV === 'bottom') {
                        arrowPosition = 'top';
                    }
                    else if (_this.positionH === 'left') {
                        arrowPosition = 'right';
                    }
                    else {
                        arrowPosition = 'left';
                    }
                    tooltipComponent.arrow = arrowPosition;
                }
                if (!_this._active) {
                    _this._tooltipTimeout = setTimeout(_this.removeTooltip.bind(_this), _this.duration);
                }
            }));
        }), this.debounce);
    };
    /**
     * @return {?}
     */
    TooltipDirective.prototype.onClick = /**
     * @return {?}
     */
    function () {
        if (this.event === TooltipEvent.CLICK) {
            this.trigger();
        }
    };
    /**
     * @return {?}
     */
    TooltipDirective.prototype.onPress = /**
     * @return {?}
     */
    function () {
        if (this.event === TooltipEvent.PRESS) {
            this.trigger();
        }
    };
    /**
     * @return {?}
     */
    TooltipDirective.prototype.onMouseEnter = /**
     * @return {?}
     */
    function () {
        if (this.event === TooltipEvent.HOVER) {
            this.active = true;
        }
    };
    /**
     * @return {?}
     */
    TooltipDirective.prototype.onMouseLeave = /**
     * @return {?}
     */
    function () {
        if (this.event === TooltipEvent.HOVER) {
            this.active = false;
        }
    };
    /**
     * @private
     * @return {?}
     */
    TooltipDirective.prototype._createTooltipComponent = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var componentFactory = this.cfr.resolveComponentFactory(TooltipBox);
        this._tooltipElement = this.vcr.createComponent(componentFactory);
        this.tooltipCtrl.addTooltip(this);
    };
    /**
     * @private
     * @return {?}
     */
    TooltipDirective.prototype._getTooltipPosition = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var tooltipNativeElement = this._tooltipElement.instance.getNativeElement();
        /** @type {?} */
        var el = this.el.nativeElement;
        /** @type {?} */
        var rect = el.getBoundingClientRect();
        /** @type {?} */
        var positionLeft;
        /** @type {?} */
        var positionTop;
        /** @type {?} */
        var spacing = 10;
        if (this.navTooltip) {
            this.positionV = 'bottom';
            this.arrow = false;
            spacing = 20;
        }
        if (this.positionH === 'right') {
            positionLeft = rect.right + spacing;
        }
        else if (this.positionH === 'left') {
            positionLeft = rect.left - spacing - tooltipNativeElement.offsetWidth;
            // -79, 19
        }
        else if (this.navTooltip) {
            positionLeft = rect.left + el.offsetWidth / 2;
        }
        else {
            positionLeft = rect.left;
        }
        if (this.positionV === 'top') {
            positionTop = rect.top - spacing - tooltipNativeElement.offsetHeight;
        }
        else if (this.positionV === 'bottom') {
            positionTop = rect.bottom + spacing;
        }
        else {
            positionTop = rect.top + el.offsetHeight / 2 - tooltipNativeElement.offsetHeight / 2;
        }
        this.topOffset++;
        if (this.topOffset) {
            positionTop += +this.topOffset;
        }
        this.leftOffset++;
        if (this.leftOffset) {
            positionLeft += +this.leftOffset;
        }
        if (positionLeft + tooltipNativeElement.offsetWidth + spacing > this.platform.width()) {
            positionLeft = this.platform.width() - tooltipNativeElement.offsetWidth - spacing;
        }
        else if (positionLeft + tooltipNativeElement.offsetWidth - spacing < 0) {
            positionLeft = spacing;
        }
        if (positionTop + tooltipNativeElement.offsetHeight + spacing > this.platform.height()) {
            positionTop = this.platform.height() - tooltipNativeElement.offsetHeight - spacing;
        }
        else if (positionTop + tooltipNativeElement.offsetHeight - spacing < 0) {
            positionTop = spacing;
        }
        return {
            left: positionLeft,
            top: positionTop,
        };
    };
    /**
     * @return {?}
     */
    TooltipDirective.prototype.removeTooltip = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this._debouncedPromise) {
            clearTimeout(this._debouncedPromise);
            this._debouncedPromise = null;
        }
        if (!this._tooltipElement) {
            this._tooltipElement = undefined;
            this._tooltipTimeout = undefined;
            return;
        }
        this._tooltipElement.instance.fadeState = 'invisible';
        this.canShow = false;
        // wait for animation to finish then clear everything out
        setTimeout((/**
         * @return {?}
         */
        function () {
            if (_this._tooltipElement &&
                typeof _this._tooltipElement.destroy === 'function') {
                _this._tooltipElement.destroy();
            }
            _this.tooltipCtrl.removeTooltip(_this);
            _this._tooltipElement = _this._tooltipTimeout = undefined;
            _this.canShow = true;
        }), 300);
    };
    /**
     * @private
     * @return {?}
     */
    TooltipDirective.prototype._resetTimer = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        clearTimeout(this._tooltipTimeout);
        this._tooltipTimeout = setTimeout((/**
         * @return {?}
         */
        function () {
            _this.active = false;
        }), this.duration);
    };
    TooltipDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[tooltip]',
                },] }
    ];
    /** @nocollapse */
    TooltipDirective.ctorParameters = function () { return [
        { type: ElementRef },
        { type: ApplicationRef },
        { type: Platform },
        { type: ComponentFactoryResolver },
        { type: TooltipController },
        { type: ViewContainerRef }
    ]; };
    TooltipDirective.propDecorators = {
        debounce: [{ type: Input }],
        desktopEvent: [{ type: Input }],
        event: [{ type: Input }],
        hideOthers: [{ type: Input }],
        leftOffset: [{ type: Input }],
        mobileEvent: [{ type: Input }],
        positionV: [{ type: Input }],
        positionH: [{ type: Input }],
        role: [{ type: Input }],
        tooltip: [{ type: Input }],
        tooltipHtml: [{ type: Input }],
        tooltipStyles: [{ type: Input }],
        topOffset: [{ type: Input }],
        navTooltip: [{ type: Input }],
        arrow: [{ type: Input }],
        duration: [{ type: Input }],
        active: [{ type: Input }],
        onClick: [{ type: HostListener, args: ['click',] }],
        onPress: [{ type: HostListener, args: ['press',] }],
        onMouseEnter: [{ type: HostListener, args: ['mouseenter',] }],
        onMouseLeave: [{ type: HostListener, args: ['mouseleave',] }]
    };
    return TooltipDirective;
}());
export { TooltipDirective };
if (false) {
    /** @type {?} */
    TooltipDirective.prototype.debounce;
    /** @type {?} */
    TooltipDirective.prototype.desktopEvent;
    /** @type {?} */
    TooltipDirective.prototype.event;
    /** @type {?} */
    TooltipDirective.prototype.hideOthers;
    /** @type {?} */
    TooltipDirective.prototype.leftOffset;
    /** @type {?} */
    TooltipDirective.prototype.mobileEvent;
    /** @type {?} */
    TooltipDirective.prototype.positionV;
    /** @type {?} */
    TooltipDirective.prototype.positionH;
    /** @type {?} */
    TooltipDirective.prototype.role;
    /** @type {?} */
    TooltipDirective.prototype.tooltip;
    /** @type {?} */
    TooltipDirective.prototype.tooltipHtml;
    /** @type {?} */
    TooltipDirective.prototype.tooltipStyles;
    /** @type {?} */
    TooltipDirective.prototype.topOffset;
    /** @type {?} */
    TooltipDirective.prototype.duration;
    /**
     * @type {?}
     * @private
     */
    TooltipDirective.prototype._active;
    /**
     * @type {?}
     * @private
     */
    TooltipDirective.prototype._arrow;
    /**
     * @type {?}
     * @private
     */
    TooltipDirective.prototype._canShow;
    /**
     * @type {?}
     * @private
     */
    TooltipDirective.prototype._debouncedPromise;
    /**
     * @type {?}
     * @private
     */
    TooltipDirective.prototype._navTooltip;
    /**
     * @type {?}
     * @private
     */
    TooltipDirective.prototype._tooltipElement;
    /**
     * @type {?}
     * @private
     */
    TooltipDirective.prototype._tooltipTimeout;
    /**
     * @type {?}
     * @private
     */
    TooltipDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    TooltipDirective.prototype.appRef;
    /**
     * @type {?}
     * @private
     */
    TooltipDirective.prototype.platform;
    /**
     * @type {?}
     * @private
     */
    TooltipDirective.prototype.cfr;
    /**
     * @type {?}
     * @private
     */
    TooltipDirective.prototype.tooltipCtrl;
    /**
     * @type {?}
     * @private
     */
    TooltipDirective.prototype.vcr;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9vbHRpcC5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9pb25pYzQtdG9vbHRpcHMvIiwic291cmNlcyI6WyJkaXJlY3RpdmVzL3Rvb2x0aXAuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBRUwsY0FBYyxFQUNkLHdCQUF3QixFQUV4QixTQUFTLEVBQ1QsVUFBVSxFQUNWLFlBQVksRUFDWixLQUFLLEVBSUwsZ0JBQWdCLEdBQ2pCLE1BQU0sZUFBZSxDQUFDO0FBRXZCLE9BQU8sRUFBQyxRQUFRLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUV4QyxPQUFPLEVBQUMsVUFBVSxFQUFDLE1BQU0saURBQWlELENBQUM7QUFDM0UsT0FBTyxFQUFDLGlCQUFpQixFQUFDLE1BQU0sa0NBQWtDLENBQUM7QUFDbkUsT0FBTyxFQUFDLFlBQVksRUFBQyxNQUFNLCtCQUErQixDQUFDO0FBRTNEO0lBMERFLDBCQUNVLEVBQWEsRUFDYixNQUFxQixFQUNyQixRQUFpQixFQUNqQixHQUE0QixFQUM1QixXQUE2QixFQUM3QixHQUFvQjtRQUxwQixPQUFFLEdBQUYsRUFBRSxDQUFXO1FBQ2IsV0FBTSxHQUFOLE1BQU0sQ0FBZTtRQUNyQixhQUFRLEdBQVIsUUFBUSxDQUFTO1FBQ2pCLFFBQUcsR0FBSCxHQUFHLENBQXlCO1FBQzVCLGdCQUFXLEdBQVgsV0FBVyxDQUFrQjtRQUM3QixRQUFHLEdBQUgsR0FBRyxDQUFpQjtRQTVEckIsYUFBUSxHQUFVLENBQUMsQ0FBQztRQUNwQixpQkFBWSxHQUFnQixZQUFZLENBQUMsS0FBSyxDQUFDO1FBVS9DLGtCQUFhLEdBQTRCLEVBQUUsQ0FBQztRQXFCNUMsYUFBUSxHQUFHLElBQUksQ0FBQztRQWNqQixZQUFPLEdBQVcsS0FBSyxDQUFDO1FBQ3hCLFdBQU0sR0FBVyxLQUFLLENBQUM7UUFDdkIsYUFBUSxHQUFXLElBQUksQ0FBQztRQUN4QixzQkFBaUIsR0FBRyxJQUFJLENBQUM7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QXlCOzs7OztJQUN6QiwrQkFBb0M7Ozs7O0lBQ3BDLHVDQUFxQzs7Ozs7SUFDckMsK0JBQTRCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgQXBwbGljYXRpb25SZWYsXG4gIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcbiAgQ29tcG9uZW50UmVmLFxuICBEaXJlY3RpdmUsXG4gIEVsZW1lbnRSZWYsXG4gIEhvc3RMaXN0ZW5lcixcbiAgSW5wdXQsXG4gIE9uRGVzdHJveSxcbiAgT25Jbml0LFxuICBSZW5kZXJlcjIsXG4gIFZpZXdDb250YWluZXJSZWYsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQge1BsYXRmb3JtfSBmcm9tICdAaW9uaWMvYW5ndWxhcic7XG5cbmltcG9ydCB7VG9vbHRpcEJveH0gZnJvbSAnLi4vY29tcG9uZW50cy90b29sdGlwLWJveC90b29sdGlwLWJveC5jb21wb25lbnQnO1xuaW1wb3J0IHtUb29sdGlwQ29udHJvbGxlcn0gZnJvbSAnLi4vY29udHJvbGxlcnMvdG9vbHRpcC5jb3Ryb2xsZXInO1xuaW1wb3J0IHtUb29sdGlwRXZlbnR9IGZyb20gJy4uL21vZGVscy90b29sdGlwLWV2ZW50Lm1vZGVsJztcblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnW3Rvb2x0aXBdJyxcbn0pXG5leHBvcnQgY2xhc3MgVG9vbHRpcERpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95IHtcbiAgQElucHV0KCkgZGVib3VuY2U6bnVtYmVyID0gMDtcbiAgQElucHV0KCkgZGVza3RvcEV2ZW50OlRvb2x0aXBFdmVudCA9IFRvb2x0aXBFdmVudC5IT1ZFUjtcbiAgQElucHV0KCkgZXZlbnQ6VG9vbHRpcEV2ZW50O1xuICBASW5wdXQoKSBoaWRlT3RoZXJzOmJvb2xlYW47XG4gIEBJbnB1dCgpIGxlZnRPZmZzZXQ6bnVtYmVyO1xuICBASW5wdXQoKSBtb2JpbGVFdmVudDpUb29sdGlwRXZlbnQ7XG4gIEBJbnB1dCgpIHBvc2l0aW9uVjpzdHJpbmc7XG4gIEBJbnB1dCgpIHBvc2l0aW9uSDpzdHJpbmc7XG4gIEBJbnB1dCgpIHJvbGU6c3RyaW5nO1xuICBASW5wdXQoKSB0b29sdGlwOnN0cmluZztcbiAgQElucHV0KCkgdG9vbHRpcEh0bWw6c3RyaW5nO1xuICBASW5wdXQoKSB0b29sdGlwU3R5bGVzOnsgW2tleTpzdHJpbmddOnN0cmluZzsgfSA9IHt9O1xuICBASW5wdXQoKSB0b3BPZmZzZXQ6bnVtYmVyO1xuXG4gIEBJbnB1dCgpXG4gIHNldCBuYXZUb29sdGlwKHZhbDpib29sZWFuKSB7XG4gICAgdGhpcy5fbmF2VG9vbHRpcCA9IHR5cGVvZiB2YWwgIT09ICdib29sZWFuJyB8fCB2YWwgIT09IGZhbHNlO1xuICB9XG5cbiAgZ2V0IG5hdlRvb2x0aXAoKTpib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5fbmF2VG9vbHRpcDtcbiAgfVxuXG4gIEBJbnB1dCgpXG4gIHNldCBhcnJvdyh2YWw6Ym9vbGVhbikge1xuICAgIHRoaXMuX2Fycm93ID0gdHlwZW9mIHZhbCAhPT0gJ2Jvb2xlYW4nIHx8IHZhbCAhPT0gZmFsc2U7XG4gIH1cblxuICBnZXQgYXJyb3coKTpib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5fYXJyb3c7XG4gIH1cblxuICBASW5wdXQoKSBkdXJhdGlvbiA9IDMwMDA7XG5cbiAgQElucHV0KClcbiAgc2V0IGFjdGl2ZSh2YWw6Ym9vbGVhbikge1xuICAgIHRoaXMuX2FjdGl2ZSA9IHR5cGVvZiB2YWwgIT09ICdib29sZWFuJyB8fCB2YWwgIT09IGZhbHNlO1xuXG4gICAgdGhpcy5fYWN0aXZlICYmIHRoaXMuY2FuU2hvdyA/XG4gICAgICB0aGlzLnNob3dUb29sdGlwKCkgOiB0aGlzLnJlbW92ZVRvb2x0aXAoKTtcbiAgfVxuXG4gIGdldCBhY3RpdmUoKTpib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5fYWN0aXZlO1xuICB9XG5cbiAgcHJpdmF0ZSBfYWN0aXZlOmJvb2xlYW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBfYXJyb3c6Ym9vbGVhbiA9IGZhbHNlO1xuICBwcml2YXRlIF9jYW5TaG93OmJvb2xlYW4gPSB0cnVlO1xuICBwcml2YXRlIF9kZWJvdW5jZWRQcm9taXNlID0gbnVsbDtcbiAgcHJpdmF0ZSBfbmF2VG9vbHRpcDpib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgX3Rvb2x0aXBFbGVtZW50OkNvbXBvbmVudFJlZjxUb29sdGlwQm94PjtcbiAgcHJpdmF0ZSBfdG9vbHRpcFRpbWVvdXQ6YW55O1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgZWw6RWxlbWVudFJlZixcbiAgICBwcml2YXRlIGFwcFJlZjpBcHBsaWNhdGlvblJlZixcbiAgICBwcml2YXRlIHBsYXRmb3JtOlBsYXRmb3JtLFxuICAgIHByaXZhdGUgY2ZyOkNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcbiAgICBwcml2YXRlIHRvb2x0aXBDdHJsOlRvb2x0aXBDb250cm9sbGVyLFxuICAgIHByaXZhdGUgdmNyOlZpZXdDb250YWluZXJSZWYsXG4gICkge1xuXG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICBpZiAodHlwZW9mIHRoaXMuZXZlbnQgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICB0aGlzLmV2ZW50ID0gdGhpcy5wbGF0Zm9ybS5pcygnbW9iaWxlJykgP1xuICAgICAgICB0aGlzLm1vYmlsZUV2ZW50IDogdGhpcy5kZXNrdG9wRXZlbnQ7XG4gICAgfVxuXG4gICAgLy8gaWYgdGhlIHRpbWVyIGhhc24ndCBleHBpcmVkIG9yIGFjdGl2ZSBpcyB0cnVlIHdoZW4gdGhlIGNvbXBvbmVudCBnZXRzIGRlc3Ryb3llZCwgdGhlIHRvb2x0aXAgd2lsbCByZW1haW4gaW4gdGhlIERPTVxuICAgIC8vIHRoaXMgcmVtb3ZlcyBpdFxuICAgIHRoaXMucmVtb3ZlVG9vbHRpcCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNob3cgdGhlIHRvb2x0aXAgaW1tZWRpYXRlbHkgYWZ0ZXIgaW5pdGlhdGluZyB2aWV3IGlmIHNldCB0b1xuICAgKi9cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIGlmICh0aGlzLl9hY3RpdmUpIHtcbiAgICAgIHRoaXMudHJpZ2dlcigpO1xuICAgIH1cbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIGlmICh0aGlzLl90b29sdGlwRWxlbWVudCAmJiB0eXBlb2YgdGhpcy5fdG9vbHRpcEVsZW1lbnQuZGVzdHJveSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgdGhpcy5fdG9vbHRpcEVsZW1lbnQuZGVzdHJveSgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgdGhlIGNhblNob3cgcHJvcGVydHlcbiAgICogRW5zdXJlIHRoYXQgdG9vbHRpcCBpcyBzaG93biBvbmx5IGlmIHRoZSB0b29sdGlwIHN0cmluZyBpcyBub3QgZmFsc2V5XG4gICAqL1xuICBzZXQgY2FuU2hvdyhzaG93OiBib29sZWFuKSB7XG4gICAgdGhpcy5fY2FuU2hvdyA9IHNob3c7XG4gIH1cblxuICAvKipcbiAgICogQHJldHVybiBUUlVFIGlmIHRoZSB0b29sdGlwIGNhbiBiZSBzaG93blxuICAgKi9cbiAgZ2V0IGNhblNob3coKTpib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5fY2FuU2hvdyAmJlxuICAgICAgKCh0eXBlb2YgdGhpcy50b29sdGlwID09PSAnc3RyaW5nJyAmJiB0aGlzLnRvb2x0aXAgIT09ICcnKVxuICAgICAgICB8fCAodHlwZW9mIHRoaXMudG9vbHRpcEh0bWwgPT09ICdzdHJpbmcnICYmIHRoaXMudG9vbHRpcEh0bWwgIT09ICcnKSk7XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlcyB0aGUgY2xpY2svcHJlc3MgZXZlbnQgYW5kIHNob3dzIGEgdG9vbHRpcC5cbiAgICogSWYgYSB0b29sdGlwIGFscmVhZHkgZXhpc3RzLCBpdCB3aWxsIGp1c3QgcmVzZXQgaXQncyB0aW1lci5cbiAgICovXG4gIHRyaWdnZXIoKTp2b2lkIHtcbiAgICBpZiAodGhpcy5jYW5TaG93KSB7XG4gICAgICBpZiAodGhpcy5fdG9vbHRpcEVsZW1lbnQpIHtcbiAgICAgICAgdGhpcy5fcmVzZXRUaW1lcigpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zaG93VG9vbHRpcCgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgbmV3IHRvb2x0aXAgY29tcG9uZW50IGFuZCBhZGp1c3RzIGl0J3MgcHJvcGVydGllcyB0byBzaG93IHByb3Blcmx5LlxuICAgKi9cbiAgc2hvd1Rvb2x0aXAoKTp2b2lkIHtcbiAgICB0aGlzLl9kZWJvdW5jZWRQcm9taXNlID0gc2V0VGltZW91dChcbiAgICAgICgpID0+IHtcbiAgICAgICAgdGhpcy5fZGVib3VuY2VkUHJvbWlzZSA9IG51bGw7XG5cbiAgICAgICAgdGhpcy5fY3JlYXRlVG9vbHRpcENvbXBvbmVudCgpO1xuXG4gICAgICAgIGNvbnN0IHRvb2x0aXBDb21wb25lbnQ6IFRvb2x0aXBCb3ggPSB0aGlzLl90b29sdGlwRWxlbWVudC5pbnN0YW5jZTtcblxuICAgICAgICB0b29sdGlwQ29tcG9uZW50LnJvbGUgPSB0aGlzLnJvbGU7XG4gICAgICAgIHRvb2x0aXBDb21wb25lbnQudGV4dCA9IHRoaXMudG9vbHRpcDtcbiAgICAgICAgdG9vbHRpcENvbXBvbmVudC50b29sdGlwU3R5bGVzID0gdGhpcy50b29sdGlwU3R5bGVzO1xuICAgICAgICB0b29sdGlwQ29tcG9uZW50LnRvb2x0aXBIdG1sID0gdGhpcy50b29sdGlwSHRtbDtcbiAgICAgICAgdG9vbHRpcENvbXBvbmVudC5pbml0LnRoZW4oKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHRvb2x0aXBQb3NpdGlvbiA9IHRoaXMuX2dldFRvb2x0aXBQb3NpdGlvbigpO1xuXG4gICAgICAgICAgdG9vbHRpcENvbXBvbmVudC5wb3NMZWZ0ID0gdG9vbHRpcFBvc2l0aW9uLmxlZnQ7XG4gICAgICAgICAgdG9vbHRpcENvbXBvbmVudC5wb3NUb3AgPSB0b29sdGlwUG9zaXRpb24udG9wO1xuXG4gICAgICAgICAgdG9vbHRpcENvbXBvbmVudC5mYWRlU3RhdGUgPSAndmlzaWJsZSc7XG5cbiAgICAgICAgICBpZiAodGhpcy5hcnJvdykge1xuICAgICAgICAgICAgbGV0IGFycm93UG9zaXRpb247XG4gICAgICAgICAgICBpZiAodGhpcy5wb3NpdGlvblYgPT09ICd0b3AnKSB7XG4gICAgICAgICAgICAgIGFycm93UG9zaXRpb24gPSAnYm90dG9tJztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5wb3NpdGlvblYgPT09ICdib3R0b20nKSB7XG4gICAgICAgICAgICAgIGFycm93UG9zaXRpb24gPSAndG9wJztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5wb3NpdGlvbkggPT09ICdsZWZ0Jykge1xuICAgICAgICAgICAgICBhcnJvd1Bvc2l0aW9uID0gJ3JpZ2h0JztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGFycm93UG9zaXRpb24gPSAnbGVmdCc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0b29sdGlwQ29tcG9uZW50LmFycm93ID0gYXJyb3dQb3NpdGlvbjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoIXRoaXMuX2FjdGl2ZSkge1xuICAgICAgICAgICAgdGhpcy5fdG9vbHRpcFRpbWVvdXQgPSBzZXRUaW1lb3V0KFxuICAgICAgICAgICAgICB0aGlzLnJlbW92ZVRvb2x0aXAuYmluZCh0aGlzKSxcbiAgICAgICAgICAgICAgdGhpcy5kdXJhdGlvbixcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgICB0aGlzLmRlYm91bmNlXG4gICAgKTtcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ2NsaWNrJylcbiAgb25DbGljaygpOnZvaWQge1xuICAgIGlmICh0aGlzLmV2ZW50ID09PSBUb29sdGlwRXZlbnQuQ0xJQ0spIHtcbiAgICAgIHRoaXMudHJpZ2dlcigpO1xuICAgIH1cbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ3ByZXNzJylcbiAgb25QcmVzcygpOnZvaWQge1xuICAgIGlmICh0aGlzLmV2ZW50ID09PSBUb29sdGlwRXZlbnQuUFJFU1MpIHtcbiAgICAgIHRoaXMudHJpZ2dlcigpO1xuICAgIH1cbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ21vdXNlZW50ZXInKVxuICBvbk1vdXNlRW50ZXIoKTp2b2lkIHtcbiAgICBpZiAodGhpcy5ldmVudCA9PT0gVG9vbHRpcEV2ZW50LkhPVkVSKSB7XG4gICAgICB0aGlzLmFjdGl2ZSA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgQEhvc3RMaXN0ZW5lcignbW91c2VsZWF2ZScpXG4gIG9uTW91c2VMZWF2ZSgpOnZvaWQge1xuICAgIGlmICh0aGlzLmV2ZW50ID09PSBUb29sdGlwRXZlbnQuSE9WRVIpIHtcbiAgICAgIHRoaXMuYWN0aXZlID0gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBfY3JlYXRlVG9vbHRpcENvbXBvbmVudCgpIHtcbiAgICBjb25zdCBjb21wb25lbnRGYWN0b3J5ID0gdGhpcy5jZnIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoVG9vbHRpcEJveCk7XG4gICAgdGhpcy5fdG9vbHRpcEVsZW1lbnQgPSB0aGlzLnZjci5jcmVhdGVDb21wb25lbnQoY29tcG9uZW50RmFjdG9yeSk7XG4gICAgdGhpcy50b29sdGlwQ3RybC5hZGRUb29sdGlwKHRoaXMpO1xuICB9XG5cbiAgcHJpdmF0ZSBfZ2V0VG9vbHRpcFBvc2l0aW9uKCkge1xuICAgIGNvbnN0IHRvb2x0aXBOYXRpdmVFbGVtZW50OkhUTUxFbGVtZW50ID0gdGhpcy5fdG9vbHRpcEVsZW1lbnQuaW5zdGFuY2UuZ2V0TmF0aXZlRWxlbWVudCgpLFxuICAgICAgZWw6SFRNTEVsZW1lbnQgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsXG4gICAgICByZWN0OkNsaWVudFJlY3QgPSBlbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgIGxldCBwb3NpdGlvbkxlZnQ6bnVtYmVyLFxuICAgICAgcG9zaXRpb25Ub3A6bnVtYmVyLFxuICAgICAgc3BhY2luZyA9IDEwO1xuXG4gICAgaWYgKHRoaXMubmF2VG9vbHRpcCkge1xuICAgICAgdGhpcy5wb3NpdGlvblYgPSAnYm90dG9tJztcbiAgICAgIHRoaXMuYXJyb3cgPSBmYWxzZTtcbiAgICAgIHNwYWNpbmcgPSAyMDtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5wb3NpdGlvbkggPT09ICdyaWdodCcpIHtcbiAgICAgIHBvc2l0aW9uTGVmdCA9IHJlY3QucmlnaHQgKyBzcGFjaW5nO1xuICAgIH0gZWxzZSBpZiAodGhpcy5wb3NpdGlvbkggPT09ICdsZWZ0Jykge1xuICAgICAgcG9zaXRpb25MZWZ0ID0gcmVjdC5sZWZ0IC0gc3BhY2luZyAtIHRvb2x0aXBOYXRpdmVFbGVtZW50Lm9mZnNldFdpZHRoO1xuICAgICAgLy8gLTc5LCAxOVxuICAgIH0gZWxzZSBpZiAodGhpcy5uYXZUb29sdGlwKSB7XG4gICAgICBwb3NpdGlvbkxlZnQgPSByZWN0LmxlZnQgKyBlbC5vZmZzZXRXaWR0aCAvIDI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHBvc2l0aW9uTGVmdCA9IHJlY3QubGVmdDtcbiAgICB9XG5cblxuICAgIGlmICh0aGlzLnBvc2l0aW9uViA9PT0gJ3RvcCcpIHtcbiAgICAgIHBvc2l0aW9uVG9wID0gcmVjdC50b3AgLSBzcGFjaW5nIC0gdG9vbHRpcE5hdGl2ZUVsZW1lbnQub2Zmc2V0SGVpZ2h0O1xuICAgIH0gZWxzZSBpZiAodGhpcy5wb3NpdGlvblYgPT09ICdib3R0b20nKSB7XG4gICAgICBwb3NpdGlvblRvcCA9IHJlY3QuYm90dG9tICsgc3BhY2luZztcbiAgICB9IGVsc2Uge1xuICAgICAgcG9zaXRpb25Ub3AgPSByZWN0LnRvcCArIGVsLm9mZnNldEhlaWdodCAvIDIgLSB0b29sdGlwTmF0aXZlRWxlbWVudC5vZmZzZXRIZWlnaHQgLyAyO1xuICAgIH1cblxuICAgIHRoaXMudG9wT2Zmc2V0Kys7XG4gICAgaWYgKHRoaXMudG9wT2Zmc2V0KSB7XG4gICAgICBwb3NpdGlvblRvcCArPSArdGhpcy50b3BPZmZzZXQ7XG4gICAgfVxuXG4gICAgdGhpcy5sZWZ0T2Zmc2V0Kys7XG4gICAgaWYgKHRoaXMubGVmdE9mZnNldCkge1xuICAgICAgcG9zaXRpb25MZWZ0ICs9ICt0aGlzLmxlZnRPZmZzZXQ7XG4gICAgfVxuXG4gICAgaWYgKHBvc2l0aW9uTGVmdCArIHRvb2x0aXBOYXRpdmVFbGVtZW50Lm9mZnNldFdpZHRoICsgc3BhY2luZyA+IHRoaXMucGxhdGZvcm0ud2lkdGgoKSkge1xuICAgICAgcG9zaXRpb25MZWZ0ID0gdGhpcy5wbGF0Zm9ybS53aWR0aCgpIC0gdG9vbHRpcE5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGggLSBzcGFjaW5nO1xuICAgIH0gZWxzZSBpZiAocG9zaXRpb25MZWZ0ICsgdG9vbHRpcE5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGggLSBzcGFjaW5nIDwgMCkge1xuICAgICAgcG9zaXRpb25MZWZ0ID0gc3BhY2luZztcbiAgICB9XG5cbiAgICBpZiAocG9zaXRpb25Ub3AgKyB0b29sdGlwTmF0aXZlRWxlbWVudC5vZmZzZXRIZWlnaHQgKyBzcGFjaW5nID4gdGhpcy5wbGF0Zm9ybS5oZWlnaHQoKSkge1xuICAgICAgcG9zaXRpb25Ub3AgPSB0aGlzLnBsYXRmb3JtLmhlaWdodCgpIC0gdG9vbHRpcE5hdGl2ZUVsZW1lbnQub2Zmc2V0SGVpZ2h0IC0gc3BhY2luZztcbiAgICB9IGVsc2UgaWYgKHBvc2l0aW9uVG9wICsgdG9vbHRpcE5hdGl2ZUVsZW1lbnQub2Zmc2V0SGVpZ2h0IC0gc3BhY2luZyA8IDApIHtcbiAgICAgIHBvc2l0aW9uVG9wID0gc3BhY2luZztcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgbGVmdDogcG9zaXRpb25MZWZ0LFxuICAgICAgdG9wOiAgcG9zaXRpb25Ub3AsXG4gICAgfTtcbiAgfVxuXG4gIHJlbW92ZVRvb2x0aXAoKSB7XG4gICAgaWYgKHRoaXMuX2RlYm91bmNlZFByb21pc2UpIHtcbiAgICAgIGNsZWFyVGltZW91dCh0aGlzLl9kZWJvdW5jZWRQcm9taXNlKTtcblxuICAgICAgdGhpcy5fZGVib3VuY2VkUHJvbWlzZSA9IG51bGw7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLl90b29sdGlwRWxlbWVudCkge1xuICAgICAgdGhpcy5fdG9vbHRpcEVsZW1lbnQgPSB1bmRlZmluZWQ7XG4gICAgICB0aGlzLl90b29sdGlwVGltZW91dCA9IHVuZGVmaW5lZDtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLl90b29sdGlwRWxlbWVudC5pbnN0YW5jZS5mYWRlU3RhdGUgPSAnaW52aXNpYmxlJztcblxuICAgIHRoaXMuY2FuU2hvdyA9IGZhbHNlO1xuXG4gICAgLy8gd2FpdCBmb3IgYW5pbWF0aW9uIHRvIGZpbmlzaCB0aGVuIGNsZWFyIGV2ZXJ5dGhpbmcgb3V0XG4gICAgc2V0VGltZW91dChcbiAgICAgICgpID0+IHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIHRoaXMuX3Rvb2x0aXBFbGVtZW50ICYmXG4gICAgICAgICAgdHlwZW9mIHRoaXMuX3Rvb2x0aXBFbGVtZW50LmRlc3Ryb3kgPT09ICdmdW5jdGlvbidcbiAgICAgICAgKSB7XG4gICAgICAgICAgdGhpcy5fdG9vbHRpcEVsZW1lbnQuZGVzdHJveSgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudG9vbHRpcEN0cmwucmVtb3ZlVG9vbHRpcCh0aGlzKTtcbiAgICAgICAgdGhpcy5fdG9vbHRpcEVsZW1lbnQgPSB0aGlzLl90b29sdGlwVGltZW91dCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5jYW5TaG93ID0gdHJ1ZTtcbiAgICAgIH0sXG4gICAgICAzMDBcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBfcmVzZXRUaW1lcigpOnZvaWQge1xuICAgIGNsZWFyVGltZW91dCh0aGlzLl90b29sdGlwVGltZW91dCk7XG4gICAgdGhpcy5fdG9vbHRpcFRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMuYWN0aXZlID0gZmFsc2U7XG4gICAgfSwgdGhpcy5kdXJhdGlvbik7XG4gIH1cbn1cbiJdfQ==